name: ðŸ“¦ Snapshot Export

on:
  schedule:
    - cron: '40 4 * * *'  # z.â€¯B. 04:40â€¯UTC = 06:40 MESZ
  workflow_dispatch:

jobs:
  snapshot:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”„ Repository klonen
        uses: actions/checkout@v3
        with:
          persist-credentials: false  # falls du spÃ¤ter PAT verwendest

      - name: ðŸ§° Git konfigurieren
        run: |
          git config user.name "actions-user"
          git config user.email "actions@github.com"

      - name: ðŸ“… Verzeichnisse vorbereiten
        run: |
          TIMESTAMP=$(date -u +'%Y-%m-%d_%H-%M-%S')
          SNAPSHOT_DIR="public/snapshots/$TIMESTAMP"
          mkdir -p "$SNAPSHOT_DIR"
          echo "ðŸ“ Snapshot wird erzeugt in $SNAPSHOT_DIR"

      - name: ðŸ“‹ Daten kopieren
        run: |
          TIMESTAMP=$(date -u +'%Y-%m-%d_%H-%M-%S')
          SNAPSHOT_DIR="public/snapshots/$TIMESTAMP"
          
          cp public/data/*.json "$SNAPSHOT_DIR/"

          # âž• Erzwungene Ã„nderung â€“ snapshot-info.txt mit Timestamp
          echo "Snapshot erstellt am $(date -u +%Y-%m-%dT%H:%M:%SZ)" > "$SNAPSHOT_DIR/__snapshot-info.txt"

      - name: ðŸš€ Commit & Push Snapshot
        run: |
          git add public/snapshots/
          git commit -m "ðŸ“¦ snapshot export: $(date -u +'%Y-%m-%d_%H-%M-%S')" || echo "Kein Commit notwendig"
          git push
