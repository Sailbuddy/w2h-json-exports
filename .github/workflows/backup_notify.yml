name: 📬 Tägliche Sicherungsbenachrichtigung

on:
  schedule:
    - cron: '10 4 * * *'  # 04:10 UTC = 06:10 MESZ
  workflow_dispatch:

jobs:
  send_mail:
    runs-on: ubuntu-latest
    steps:
      - name: 📋 Installiere & führe Analyse mit Fallback aus
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "📋 Workflow Status:" > body.txt
          echo "" >> body.txt

          # Installiere jq
          sudo apt-get update
          sudo apt-get install -y jq

          # Sicherheitsmaßnahme für PATH
          export PATH=$PATH:/usr/bin:/usr/local/bin

          # Abfrage der letzten Workflow-Runs
          gh api repos/${{ github.repository }}/actions/runs --paginate -q '.workflow_runs[:5]' > runs.json

          COUNT=$(jq length runs.json)

          if [ "$COUNT" -eq 0 ]; then
            echo "⚠️ Keine Workflows gefunden." >> body.txt
            echo "" >> body.txt
            echo "📦 Debug: Inhalt von runs.json:" >> body.txt
            cat runs.json >> body.txt
          else
            for i in $(seq 0 $(($COUNT - 1))); do
              NAME=$(jq -r ".[$i].name" runs.json)
              STATUS=$(jq -r ".[$i].conclusion" runs.json)
              TIME=$(jq -r ".[$i].run_started_at" runs.json)
              ID=$(
